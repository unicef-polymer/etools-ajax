<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../etools-dexiejs/dexie.html">

<link rel="import" href="../etools-ajax-v2.html">

<script>
  // set logging level
  window.EtoolsLogsLevel = window.EtoolsLogsLevel || 'INFO';
  // custom dexie db that will be used by etoolsAjax
  var etoolsCustomDexieDb = new Dexie('etoolsAjax2DexieDb');
  etoolsCustomDexieDb.version(1).stores({
    listsExpireMapTable: "&name, expire",
    ajaxDefaultDataTable: "&cacheKey, data, expire",
    countries: "&id, name"
  });

  // configure app dexie db to be used for caching
  window.EtoolsRequestCacheDb = etoolsCustomDexieDb;

</script>

<dom-module id="direct-ajax-calls">

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'direct-ajax-calls',

        behaviors: [EtoolsRequest],

        properties: {

        },

        ready: function() {

          console.log(this.etoolsAjaxCacheDb);

          this._setCookie();

          this.post_Json();
          this.patch_WithJsonContent();
         //this.get_WithNoCache();
         //this.get_WithCacheToDefaultTable();
         //this.get_WithCacheToSpecifiedTable();

        },
        post_Json: function() {
           this.sendRequest({
             method: 'POST',
              endpoint: {
                url: 'http://192.168.1.184/silex-test-app/web/index.php/handle-post-put-delete-data',
              },
              body:{
                 id: "14",
                 firstName: "JaneTEST",
                 lastName: "DoeTest"
              }
            }).then(function(resp) {
              console.log(resp);
            }).catch(function(error) {
              console.log(error);
            });
        },
        patch_WithJsonContent: function(){
          this.sendRequest({
             method: 'PATCH',
              endpoint: {
                url: 'http://192.168.1.184/silex-test-app/web/index.php/handle-post-put-delete-data',
              },
              body:{
                 id: "14",
                 firstName: "JaneTEST2"
              }
            }).then(function(resp) {
              console.log(resp);
            }).catch(function(error) {
              console.log(error);
            });
        },

        get_WithNoCache: function() {
            this.sendRequest({
              endpoint: {
                url: 'http://192.168.1.184/silex-test-app/web/index.php/countries-data',
              }
            }).then(function(resp) {
              console.log(resp);
            }).catch(function(error) {
              console.log(error);
            });
        },

        get_WithCacheToDefaultTable: function() {
          this.sendRequest({
              endpoint: {
                url: 'http://192.168.1.184/silex-test-app/web/index.php/countries-data',
                exp: 5*60*1000, // cache set for 5m
                cachingKey: 'countries',
              }
            }).then(function(resp) {
              console.log(resp);
            }).catch(function(error) {
              console.log(error);
            });
        },

        get_WithCacheToSpecifiedTable: function(){
           this.sendRequest({
              endpoint: {
                url: 'http://192.168.1.184/silex-test-app/web/index.php/countries-data',
                exp: 5*60*1000, // cache set for 5m
                cacheTableName: 'countries'
              }
            }).then(function(resp) {
              console.log(resp);
            }).catch(function(error) {
              console.log(error);
            });
        },

        _setCookie: function() {
          // set cookie
          var cookieVal = 'someCookieValue123';
          var d = new Date();
          d.setTime(d.getTime() + (1*60*60*1000));
          var expires = "expires="+ d.toUTCString(); // cookie will expire in 1 hour
          document.cookie = "csrftoken=" + cookieVal + "; " + expires + "; path=/";
        }

      });

    })();
  </script>
</dom-module>
