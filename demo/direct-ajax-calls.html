<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../etools-dexiejs/etools-dexiejs.html">
<link rel="import" href="../etools-ajax-v2.html">

<script>
  // custom dexie db that will be used by etoolsAjax
  var etoolsCustomDexieDb = new Dexie('etoolsAjax2DexieDb');
  etoolsCustomDexieDb.version(1).stores({
    collectionsMap: "&name, expire",
    ajaxDefaultDataCollection: "&cacheKey, data, expire",
    countries: "&id, name"
  });

</script>

<dom-module id="direct-ajax-calls">

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'direct-ajax-calls',

        behaviors: [EtoolsRequest],

        properties: {

        },

        ready: function() {

          this.etoolsAjaxCacheDb = etoolsCustomDexieDb;
          console.log(this.etoolsAjaxCacheDb);

          this._setCookie();

          // EtoolsAjax.setConfigDefaults({
          //   baseURL: 'https://httpbin.org'
          // });

          // EtoolsAjax.get('/get').then(function (response) {
          //   console.log('response', response);
          // })
          // .catch(function (error) {
          //   console.log('error', error);
          // });

          this.sendRequest({
//            method: 'POST',
            endpoint: {
              url: 'http://silex-test-app.local/countries-data', //'https://httpbin.org/get',
              exp: 5*60*1000, // cache set for 5m
              cachingKey: 'countries',
              cacheTableName: 'countries'
            }
          }).then(function(resp) {
            console.log(resp);
          }).catch(function(err) {
            console.log(err);
          });
        },

        _setCookie: function() {
          // set cookie
          var cookieVal = 'someCookieValue123';
          var d = new Date();
          d.setTime(d.getTime() + (1*60*60*1000));
          var expires = "expires="+ d.toUTCString(); // cookie will expire in 1 hour
          document.cookie = "csrftoken=" + cookieVal + "; " + expires + "; path=/";
        }

      });

    })();
  </script>
</dom-module>
