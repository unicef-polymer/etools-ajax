<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../etools-ajax.html">

<dom-module id="csrf-cookie">
  <template>
    <etools-ajax url="http://silex-test-app.local/get-csrf-token" on-response="_handleResponse"></etools-ajax>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'csrf-cookie',
        properties: {
          csrfToken: {
            type: Object,
            value: null
          }
        },
        _handleResponse: function(res) {
          this.csrfToken = res.detail;

          // set cookie
          var d = new Date();
          d.setTime(d.getTime() + (1*24*60*60*1000));
          var expires = "expires="+ d.toUTCString(); // cookie will expire in 1 day
          document.cookie = "csrftoken=" + this.csrfToken.token_value + "; " + expires + "; path=/";
        }
      });

    })();
  </script>
</dom-module>
