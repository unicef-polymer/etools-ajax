<link rel="import" href="../../polymer/polymer.html">
<!--<link rel="import" href="../etools-ajax.html">-->

<dom-module id="multipart-demo-data">

  <script>
    (function() {
      // jscs:disable
      'use strict';

      Polymer({
        is: 'multipart-demo-data',
        properties: {
          bodyPost: {
            type: Object,
            value: null,
            notify: true
          }
        },

        ready: function() {
          this._processImgFile('big-image.jpg'); // image of more than 8Mb placed inside demo folder
        },

        _processImgFile: function (imageURL) {
          var _self = this;
          var image = new Image();
          var onload = function () {
            var canvas = document.createElement("canvas");
            canvas.width =this.width;
            canvas.height =this.height;

            var ctx = canvas.getContext("2d");
            ctx.drawImage(this, 0, 0);

            canvas.toBlob(function(blob) {
              // do stuff with blob
              console.log(blob);
              _self.set('bodyPost', {
                id: "13",
                firstName: "John",
                lastName: "Doe",
                testObj: {
                  id: 1,
                  name: 'testing'
                },
                testArr: [
                  {
                    id: 2,
                    name: 'testing 2',
                    someArray: [1,3],
                    hahah: {
                      test: [1,2,3, function () {
                          var content = '<a id="id1"><b id="b">hey you 1!</b></a>';
                          return new Blob([content], { type: "text/xml"});
                        }()],
                      ahaaaaaaaa: {
                        id: 1,
                        id_2: [
                          { 
                            file: function () {
                            var content = '<a id="id2"><b id="b">hey you 2!</b></a>';
                            return new Blob([content], { type: "text/xml"});
                            }()
                          }
                        ],
                        objectHahaha: {
                          partner: 1,
                          agreement: 2,
                          assessment: function () {
                            var content = '<a id="id3"><b id="b">hey you 3!</b></a>';
                            return new Blob([content], { type: "text/xml"});
                            }()
                        }
                      }
                    }
                  },
                  1,2,3,4,5,
                  function () {
                    var content = '<a id="someId"><b id="b">hey you!</b></a>';
                    return new Blob([content], { type: "text/xml"});
                  }(),
                ],
                testArr2: [],
                someFile: function () {
                  var content = '<a id="a"><b id="b">hey!</b></a>';
                  return new Blob([content], { type: "text/xml"});
                }(),
                bigImage: blob
              });
            });
          };

          image.onload = onload;
          image.src = imageURL;
        }

      });

    })();
  </script>
</dom-module>
