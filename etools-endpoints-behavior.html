<script>
  (function(window) {
    'use strict';

    function defineEtoolsEndpoints() {
      var etoolsEndpoints = {

        useCSRF: false,
        csrf: {
          xsrfHeaderName: 'x-csrftoken',
          xsrfCookieName: 'csrftoken'
        },

        cacheDb: null,


        setConfigDefaults: function(config, csrf) {
          // set global configs
          if (config && typeof config === 'object') {
            if (typeof config.useCSRF !== 'undefined') {
              this.useCSRF = config.useCSRF;
              delete config.useCSRF;
            }

            if (typeof config.cacheDb instanceof Dexie) {
              this.cacheDb = config.cacheDb;
              delete config.cacheDb;
            }

            this.config = this._prepareConfig(config);
          }
          // config/activate csrf
          if (csrf && typeof csrf === 'object' && csrf.headerName && csrf.cookieName) {
            this.csrf = Object.assign({}, csrf);
            this.useCSRF = true;
          }
        },

        _prepareConfig: function(config) {
          return Object.assign({}, this.config, config);
        },

        _validateEndpointObject: function(endpoint) {
          if (typeof endpoint === 'object' && typeof endpoint.url === 'string' && endpoint.url !== '') {
            return true;
          }
          return false;
        },

        _getEndpointUrl: function(endpoint) {
          var url = null;
          if (!this._validateEndpointObject(endpoint)) {
            if (typeof endpoint === 'string' && endpoint !== '') {
              url = endpoint;
            }
          } else {
            url = endpoint.url;
          }
          return url;
        },

        _getEndpointCacheKey: function(endpoint, params) {
          var cacheKey = endpoint.url;
          if (typeof endpoint.cachingKey === 'string' && endpoint.cachingKey !== '') {
            cacheKey = endpoint.cachingKey;
          }
          if (params) {
            cacheKey += '_' + JSON.stringify(params);
          }
          return cacheKey;
        },

        get: function(endpoint, config) {
          // get URL
          var url = this._getEndpointUrl(endpoint);
          if (!url) {
            // no url, do not continue
            return;
          }
          // check for cached data
          if (typeof endpoint === 'object' && typeof endpoint.exp === 'number' && endpoint.exp > 0) {

          }


        },

      };
      return etoolsEndpoints;
    }

    window.EtoolsEndpointsBehavior = window.EtoolsEndpointsBehavior || defineEtoolsEndpoints();
  })(window);
</script>
